Element.implement({reflect:function(e){var t=this;if("img"==t.get("tag")){function i(){var i,r,a,l,s,n=t.width,o=t.height;if(r=Math.floor(e.height>1?Math.min(o,e.height):o*e.height),(i=new Element("canvas")).getContext)try{(l=i.setProperties({width:n,height:r}).getContext("2d")).save(),l.translate(0,o-1),l.scale(1,-1),l.drawImage(t,0,0,n,o),l.restore(),l.globalCompositeOperation="destination-out",(s=l.createLinearGradient(0,0,0,r)).addColorStop(0,"rgba(255, 255, 255, "+(1-e.opacity)+")"),s.addColorStop(1,"rgba(255, 255, 255, 1.0)"),l.fillStyle=s,l.rect(0,0,n,r),l.fill()}catch(e){return}else{if(!Browser.ie)return;i=new Element("img",{src:t.src,styles:{width:n,height:o,marginBottom:r-o,filter:"FlipV progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*e.opacity+", FinishOpacity=0, Style=1, StartX=0, StartY=0, FinishX=0, FinishY="+r/o*100+")"}})}i.setStyles({display:"block",border:0}),(a=new Element("a"==$(t.parentNode).get("tag")?"span":"div").inject(t,"after").adopt(t,i)).className=t.className,t.store("reflected",a.style.cssText=t.style.cssText),a.setStyles({width:n,height:o+r,overflow:"hidden"}),t.style.cssText="display: block; border: 0px",t.className="reflected"}e=Object.append({height:1/3,opacity:.5},e),t.unreflect(),t.complete?i():t.onload=i}return t},unreflect:function(){var e,t=this,i=this.retrieve("reflected");return t.onload=function(){},null!==i&&(e=t.parentNode,t.className=e.className,t.style.cssText=i,t.eliminate("reflected"),e.parentNode.replaceChild(t,e)),t}}),window.addEvent("domready",(function(){$$("img").filter((function(e){return e.hasClass("reflect")})).reflect({})}));